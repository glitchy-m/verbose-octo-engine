<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scammer Baiter</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #ddd;
      padding: 2em;
    }
    .chat {
      max-width: 600px;
      margin: auto;
    }
    .msg {
      margin: 1em 0;
      padding: 1em;
      border-radius: 8px;
    }
    .user {
      background: #333;
    }
    .grandpa {
      background: #222;
    }
    button {
      margin-top: 1em;
      padding: 0.5em 1em;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <div class="chat" id="chat"></div>
  <input type="text" id="input" placeholder="Say something scammy..." style="width:100%; padding:1em; font-size:1.2em;">
  <button id="start-voice">üéôÔ∏è Start Voice</button>
  <script>
    const ELEVENLABS_API_KEY = "sk_9a64df1f99c7895f18e9e96f8ffc44892a03441b96da651d";
    const OLD_PERSON_VOICE_ID = "NOpBlnGInO9m6vDvFkFC";
    const GEMINI_API_KEY = "AIzaSyCCddHHfolQcMW5sScWlW8fluxZ5oo22fI";

    const chatBox = document.getElementById("chat");
    const input = document.getElementById("input");
    const startVoiceBtn = document.getElementById("start-voice");
    let currentAudio = null;

    input.addEventListener("keydown", async e => {
      if (e.key === "Enter") {
        const userText = input.value;
        input.value = "";
        await processMessage(userText);
      }
    });

    startVoiceBtn.onclick = () => {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    alert("Speech Recognition not supported in this browser. Try using Google Chrome on HTTPS.");
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onstart = () => {
    console.log("üéôÔ∏è Listening...");
  };

  recognition.onresult = async (event) => {
    const userText = event.results[0][0].transcript;
    console.log("You said:", userText);
    await processMessage(userText);
  };

  recognition.onerror = (event) => {
    console.error("Speech recognition error:", event.error);
    alert("Speech recognition error: " + event.error);
  };

  recognition.onend = () => {
    console.log("üõë Done listening.");
  };

  recognition.start();
};


    async function processMessage(userText) {
      addMessage("You", userText, "user");
      if (currentAudio && !currentAudio.paused) {
        currentAudio.pause();
      }
      const reply = await askGemini(userText);
      addMessage("Grandpa", reply, "grandpa");
      await playTTS(reply);
    }

    function addMessage(speaker, text, cls) {
      const div = document.createElement("div");
      div.className = `msg ${cls}`;
      div.innerHTML = `<strong>${speaker}:</strong><br>${text}`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function askGemini(text) {
      const prompt = `You are a slightly confused but sharp-witted elderly man, roughly 65 years old, pretending to be a vulnerable target. You're in a phone call with a scammer. Everything you say will be spoken out loud, so make it sound natural, like spoken conversation.

Your job is to waste the scammer‚Äôs time while sounding polite and cooperative. Act like you're struggling to understand things ‚Äî maybe due to age or technical confusion ‚Äî but throw in comments about old memories, your wife Margaret, your grandson who knows about computers, and random old-man tangents to keep the scammer engaged.

Avoid giving real information and never directly accuse the scammer, just keep them talking. Add some southern charm and sprinkle in confusion. You're clever ‚Äî you're baiting them. Keep your answers short and snappy, under 60 words each.

Caller said: "${text}"`;

      try {
        const response = await fetch(
          "https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent?key=" + GEMINI_API_KEY,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }]
            })
          }
        );

        const data = await response.json();
        console.log("Gemini:", data);
        return data?.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I didn‚Äôt catch that ‚Äî say it again, sugar.";
      } catch (err) {
        console.error("Gemini error:", err);
        return "Sorry, I didn‚Äôt catch that ‚Äî say it again, sugar.";
      }
    }

    async function playTTS(text) {
      const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${OLD_PERSON_VOICE_ID}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "xi-api-key": ELEVENLABS_API_KEY
        },
        body: JSON.stringify({
          model_id: "eleven_flash_v2_5",
          text: text,
          voice_settings: {
            stability: 0.4,
            similarity_boost: 0.75,
            use_speaker_boost: true
          }
        })
      });

      const audioBlob = await response.blob();
      const audioUrl = URL.createObjectURL(audioBlob);
      currentAudio = new Audio(audioUrl);
      currentAudio.play();
    }
  </script>
</body>
</html>
